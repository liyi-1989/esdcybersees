---
title: "Matrix Norm"
date: "June 28, 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Here are some simulation results on the norm compression inequality for the Schatten p norm.

## 1. function for calculating the Schatten p norm

It is calculated based on the definition using singular values(use SVD to get singular values). $$||A||=(\sum_{i=1}^{r}\sigma_i^{p}(A))^{\frac{1}{p}}$$

```{r}
# Calculate the Schatten p norm
schatten_norm=function(B,p){
  res=rep(0,length(p))
  for(i in 1:length(p)){
    res[i]=(sum((svd(B)$d)^p[i]))^(1/p[i])
  }
  return(res)
}
```

## 2. function to compress matrix A

A must be a square matrix, and the row and column partition is the same(but each can be unevenly partitioned), with Schatten p norm.

```{r}
# Compress the matrix A according to partition d, with Schatten p norm
norm_compress=function(A,d,p){
  n=length(d)
  A1=matrix(0,n,n)
  D=c(0,cumsum(d))
  for(i in 1:n){
    for(j in 1:n){
      idx=(D[i]+1):D[i+1]
      idy=(D[j]+1):D[j+1]
      A1[i,j]=schatten_norm(A[idx,idy],p)
    }
  }
  return(A1)
}
```


## 3. function to do simulation

- input: size of the matrix (n), and partition (d, sum is n)
- output: 
    - plot of Schatten p norm for matrix A, and its compressed version N(A), for $p=1,1.1,1.2,\cdots,4.8,4.9,5$. 
    - Eigenvalues of A
    - difference between norm of A, and norm of N(A), i.e. $norm(A)-norm(N(A))$


Note that the matrix A is simply generated with $n^2$ uniform $[0,1]$ random numbers. 

```{r}
# Do simulation: for matrix size n by n, partition d
simu=function(n,d){
  A=matrix(runif(n*n),n,n)
  #A=matrix(rnorm(n*n),n,n)
  p=(10:50)/10
  r0=r1=rep(0,length(p))
  for(i in 1:length(p)){
    A1=norm_compress(A,d,p[i])
    r0[i]=schatten_norm(A,p[i]) # norm of A
    r1[i]=schatten_norm(A1,p[i]) # norm of compressed A, which is A1
  }
  plot(p,r0,col="red",type="o",xlab="p",ylab="Norm",
       main=paste0("Schatten p norm: ","Partition:",
                   paste0(d,sep=",",collapse = "")," Size:",n))
  points(p,r1,col="blue",type="o")
  legend("topright",c("Norm of A","Norm of Compressed N(A)"),col=c("red","blue"),
         lty =1,pch=1)
  print("Eigenvalues of A:")
  print(eigen(A)$values)
  print("norm(A)-norm(N(A)):")
  print(round(r0-r1,2))
}
```

## 4. some results

From the following results,

- When $p=2$ (the $11^{th}$ difference), the two norms are equal, which confirms your finding that for the Frobenius norm, the equal sign holds.
- It seems that when $1\le p<2$, the norm is decreased by compression, while when $p>2$, the norm is increased by compression. 


```{r}
# 9 by 9, partition with 3+3+3
simu(9,c(3,3,3))
# 9 by 9, partition with 2+7
simu(9,c(2,7))
# 20 by 20, partition with 5+5+5+5
simu(20,c(5,5,5,5))
# 100 by 100, partition with 20+30+50
simu(100,c(20,30,50))
```


## 5. Other Matrices

However, the difference between the norms is not always monotone decreasing with $p$. I tried Toeplitz matrix from $n$ to 1(1 to $n$ still monotone), something like:

```{r}
toeplitz(6:1)
```

Even though the inequality still holds, $p=1$ becomes another equality, and the difference increase first and then decrease(and finally negative after $p=2$). 

```{r}
simu2=function(n,d){
  A=toeplitz(n:1)
  #A=t(A)%*%A
  p=(50:150)/50
  r0=r1=rep(0,length(p))
  for(i in 1:length(p)){
    A1=norm_compress(A,d,p[i])
    r0[i]=schatten_norm(A,p[i]) # norm of A
    r1[i]=schatten_norm(A1,p[i]) # norm of compressed A, which is A1
  }
  par(mfrow=c(1,1))
  plot(p,r0,col="red",type="o",xlab="p",ylab="Norm",main=paste0("Schatten p norm: ","Partition:",paste0(d,sep=",",collapse = "")," Size:",n))
  points(p,r1,col="blue",type="o")
  legend("topright",c("Norm of A","Norm of Compressed N(A)"),col=c("red","blue"),lty =1,pch=1)
  print("norm(A)-norm(N(A)):")
  print(round(r0-r1,2))
  plot(p,r0-r1,xlab="p",ylab="Norm Difference",col="blue",type="o",main=paste0("Norm(A)-Norm(N(A)): ","Partition:",paste0(d,sep=",",collapse = "")," Size:",n))
  abline(0,0)
}

simu2(9,c(3,3,3))
simu2(9,c(2,7))
simu2(20,c(5,5,5,5))
simu2(100,c(20,30,50))
```




